<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flask eCommerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
  <h1>Products</h1>
  <div id="product-list" class="row"></div>

  <h2 class="mt-5">Shopping Cart</h2>
  <ul id="cart-list" class="list-group"></ul>

<script>
async function loadProducts() {
  const res = await fetch('/api/products');
  const products = await res.json();
  const list = document.getElementById('product-list');
  list.innerHTML = '';
  products.forEach(p => {
    const div = document.createElement('div');
    div.className = 'col-md-4';
    div.innerHTML = `
      <div class="card mb-3 p-3">
        <h5>${p.name}</h5>
        <p>${p.description}</p>
        <p><strong>$${p.price.toFixed(2)}</strong></p>
        <button class="btn btn-success add-cart" data-id="${p.id}">Add to Cart</button>
      </div>`;
    list.appendChild(div);
  });
  document.querySelectorAll('.add-cart').forEach(btn => {
    btn.onclick = async () => {
      await fetch(`/add_to_cart/${btn.dataset.id}`, { method: 'POST' });
      loadCart();
    };
  });
}

async function loadCart() {
  const res = await fetch('/api/cart');
  const items = await res.json();
  const list = document.getElementById('cart-list');
  list.innerHTML = '';
  if (items.length === 0) {
    list.innerHTML = '<li class="list-group-item">Your cart is empty.</li>';
    return;
  }
  items.forEach(i => {
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between';
    li.textContent = i.name;
    const span = document.createElement('span');
    span.textContent = `$${i.price.toFixed(2)}`;
    li.appendChild(span);
    list.appendChild(li);
  });
}

window.onload = () => { loadProducts(); loadCart(); };
</script>
</body>
</html>
